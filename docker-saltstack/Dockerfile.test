FROM python:3.11-alpine

# Install system dependencies
RUN apk add --no-cache \
    bash \
    curl \
    jq \
    git

# Install Python packages
RUN pip install --no-cache-dir \
    pytest \
    pytest-html \
    requests \
    pyyaml \
    docker \
    saltstack

# Install Salt CLI tools
RUN pip install --no-cache-dir salt

# Create test directory
WORKDIR /tests

# Copy test scripts
COPY tests/ /tests/
COPY scripts/run-tests.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/run-tests.sh

ENTRYPOINT ["/usr/local/bin/run-tests.sh"]
