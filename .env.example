# ====================================================================
# AI Infrastructure Matrix - 统一环境变量配置
# ====================================================================
# 版本: v3.1.0
# 作者: AI Infrastructure Team
# 说明: 此文件包含所有服务的环境变量配置，支持Docker Compose和Helm部署
# ====================================================================

# ==================== 基础配置 ====================
# 项目名称
COMPOSE_PROJECT_NAME=ai-infra-matrix

# 镜像版本标签
IMAGE_TAG=v0.3.6-dev

# 私有镜像仓库地址 (开发环境可选，CI/CD环境必须)
PRIVATE_REGISTRY=

# 环境类型 (development/staging/production)
BUILD_ENV=development
DEBUG_MODE=true
LOG_LEVEL=debug

# 环境文件配置
ENV_FILE=.env

# 时区设置
TZ=Asia/Shanghai

# ==================== 动态域名配置 ====================
# 外部访问主机 (自动检测或手动设置)
EXTERNAL_HOST=${EXTERNAL_HOST}
# 域名配置 (可设置为IP或域名)
DOMAIN=${EXTERNAL_HOST}
# 主要服务端口 (修改此端口即可重新部署整个服务栈)
EXTERNAL_PORT=${EXTERNAL_PORT}
# 服务协议
EXTERNAL_SCHEME=${EXTERNAL_SCHEME}

# 服务端口映射 (基于 EXTERNAL_PORT 自动计算)
# 主入口: EXTERNAL_PORT (8080)
# JupyterHub: EXTERNAL_PORT + 8 (8088)  
# Gitea: EXTERNAL_PORT - 5070 (3010)
# AppHub包仓库: EXTERNAL_PORT + 45354 (53434) - 用于内部包管理服务
# HTTPS: EXTERNAL_PORT + 363 (8443)
# 调试端口: EXTERNAL_PORT - 79 (8001)
NGINX_PORT=${EXTERNAL_PORT}
JUPYTERHUB_EXTERNAL_PORT=${JUPYTERHUB_PORT}
GITEA_EXTERNAL_PORT=${GITEA_PORT}
APPHUB_PORT=${APPHUB_PORT}
HTTPS_PORT=${HTTPS_PORT}
DEBUG_PORT=${DEBUG_PORT}

# ==================== 数据库配置 ====================
# PostgreSQL 配置
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=ansible_playbook_generator
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

# PostgreSQL JupyterHub 数据库
JUPYTERHUB_DB_NAME=jupyterhub_db
JUPYTERHUB_DB_USER=postgres
JUPYTERHUB_DB_PASSWORD=postgres

# Gitea 数据库配置
GITEA_DB_TYPE=postgres
GITEA_DB_HOST=postgres:5432
GITEA_DB_NAME=gitea
GITEA_DB_USER=gitea
GITEA_DB_PASSWD=gitea-password

# OceanBase 数据库配置
OB_HOST=oceanbase
OB_PORT=2881
OB_USER=root
OB_PASSWORD=
OB_DATABASE=aimatrix
OB_INIT_DIR=./data/oceanbase/init.d

# MySQL 数据库配置 (用于SLURM等服务)
MYSQL_HOST=mysql
MYSQL_PORT=3306
MYSQL_ROOT_PASSWORD=mysql123
MYSQL_DATABASE=slurm_acct_db
MYSQL_USER=slurm
MYSQL_PASSWORD=slurm123

# ==================== 缓存配置 ====================
# Redis 配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=ansible-redis-password
REDIS_DB=0
REDIS_CACHE_DB=1

# ==================== LDAP 配置 ====================
# OpenLDAP 配置
LDAP_SERVER=openldap
LDAP_PORT=389
LDAP_BASE_DN=dc=ai-infra,dc=com
LDAP_BIND_DN=cn=admin,dc=ai-infra,dc=com
LDAP_ADMIN_PASSWORD=admin123
LDAP_CONFIG_PASSWORD=config123

# LDAP 用户管理
LDAP_USER_BASE=ou=users,dc=ai-infra,dc=com
LDAP_GROUP_BASE=ou=groups,dc=ai-infra,dc=com
LDAP_USER_FILTER=(uid=%s)
LDAP_ADMIN_GROUP=administrators

# ==================== 存储配置 ====================
# MinIO S3 兼容存储
MINIO_HOST=minio
MINIO_PORT=9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET_DEFAULT=ai-infra
MINIO_BUCKET_GITEA=gitea
MINIO_BUCKET_JUPYTER=jupyter

# 存储类型选择 (local/minio/s3)
STORAGE_TYPE=local
GITEA_STORAGE=local

# MinIO Web控制台配置
MINIO_CONSOLE_HOST=minio
MINIO_CONSOLE_PORT=9001
# 使用nginx代理路径，避免跨域问题
MINIO_CONSOLE_URL=http://192.168.18.137:8080/minio-console
MINIO_CONSOLE_ENABLED=true

# 对象存储iframe集成配置
OBJECT_STORAGE_IFRAME_ENABLED=true
OBJECT_STORAGE_DEFAULT_TYPE=minio

# ==================== 认证配置 ====================
# JWT 配置
JWT_SECRET=ai-infra-secret-key-change-in-dev
JWT_EXPIRY=24h
JWT_REFRESH_EXPIRY=168h

# Session 配置
SESSION_SECRET=ai-infra-session-secret-key
SESSION_TIMEOUT=86400

# OAuth 配置 (可选)
OAUTH_ENABLED=false
OAUTH_CLIENT_ID=
OAUTH_CLIENT_SECRET=
OAUTH_REDIRECT_URL=

# ==================== AI 助手配置 ====================
# OpenAI 配置 (请替换为真实的API密钥)
OPENAI_API_KEY=sk-proj-example123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_DEFAULT_MODEL=gpt-4
OPENAI_MAX_TOKENS=4096
OPENAI_TEMPERATURE=0.7

# Claude 配置 (请替换为真实的API密钥)
CLAUDE_API_KEY=sk-ant-example123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
CLAUDE_BASE_URL=https://api.anthropic.com
CLAUDE_DEFAULT_MODEL=claude-3-5-sonnet-20241022
CLAUDE_MAX_TOKENS=4096
CLAUDE_TEMPERATURE=0.7

# 本地 AI 模型配置
LOCAL_AI_ENABLED=false
LOCAL_AI_BASE_URL=http://localhost:8080/v1
LOCAL_AI_DEFAULT_MODEL=llama2

# MCP (Model Context Protocol) 配置
MCP_ENABLED=false
MCP_SERVER_PATH=
MCP_SERVER_ARGS=

# DeepSeek 配置
DEEPSEEK_API_KEY=
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_DEFAULT_MODEL=deepseek-chat

# GLM 配置 (智谱AI)
GLM_API_KEY=
GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4
GLM_DEFAULT_MODEL=glm-4

# 通义千问配置
QWEN_API_KEY=
QWEN_BASE_URL=https://dashscope.aliyuncs.com/api/v1
QWEN_DEFAULT_MODEL=qwen-turbo

# AI 助手通用配置
AI_ASSISTANT_ENABLED=true
AI_ASSISTANT_LOG_LEVEL=info
AI_ASSISTANT_MAX_CONVERSATIONS=1000
AI_ASSISTANT_MAX_MESSAGES_PER_CONVERSATION=100
AI_ASSISTANT_DEFAULT_SYSTEM_PROMPT=你是一个智能的AI助手，请提供准确、有用的回答。

# AI 助手数据库配置 (使用主MySQL数据库)
AI_DB_HOST=mysql
AI_DB_PORT=3306
AI_DB_NAME=ai_assistant
AI_DB_USER=ai_user
AI_DB_PASSWORD=ai_password123

# 强制重新初始化AI配置 (设置为true以清理并重新创建AI配置)
FORCE_AI_REINIT=false

# 服务初始化配置
SALTSTACK_ENABLED=true
SLURM_ENABLED=true

# ==================== JupyterHub 配置 ====================
# JupyterHub 基础配置
JUPYTERHUB_HOST=jupyterhub
JUPYTERHUB_PORT=8000
CONFIGPROXY_AUTH_TOKEN=ai-infra-proxy-token-dev
JUPYTERHUB_CRYPT_KEY=790031b2deeb70d780d4ccd100514b37f3c168ce80141478bf80aebfb65580c1
JUPYTERHUB_ADMIN_USERS=admin,jupyter-admin

# JupyterHub 镜像配置
JUPYTERHUB_IMAGE=ai-infra-singleuser:v0.3.6-dev
JUPYTERHUB_NETWORK=ai-infra-network

# JupyterHub 资源限制
JUPYTERHUB_MEM_LIMIT=2G
JUPYTERHUB_CPU_LIMIT=1.0

# JupyterHub 自动清理
JUPYTERHUB_IDLE_CULLER_ENABLED=true
JUPYTERHUB_IDLE_TIMEOUT=3600
JUPYTERHUB_CULL_TIMEOUT=7200

# JupyterHub 集成配置
JUPYTERHUB_AUTO_LOGIN=true
JUPYTERHUB_DEV_MODE=true
USE_CUSTOM_AUTH=true
AI_INFRA_BACKEND_URL=http://backend:8082
AI_INFRA_API_TOKEN=ai-infra-hub-token

# JupyterHub 网络配置 (动态生成)
JUPYTERHUB_USE_PROXY=true
JUPYTERHUB_PUBLIC_HOST=${EXTERNAL_HOST}:${EXTERNAL_PORT}
JUPYTERHUB_BASE_URL=${EXTERNAL_SCHEME}://${EXTERNAL_HOST}:${EXTERNAL_PORT}/jupyter/
JUPYTERHUB_CORS_ORIGIN=${EXTERNAL_SCHEME}://${EXTERNAL_HOST}:${EXTERNAL_PORT}

# JupyterHub 调试配置
JUPYTERHUB_DEBUG=false
JUPYTERHUB_LOG_LEVEL=INFO
JUPYTERHUB_ACCESS_LOG=true

# ==================== Gitea 配置 ====================
# Gitea 基础配置
GITEA_ENABLED=true
GITEA_HOST=gitea
GITEA_PORT=3000
GITEA_BASE_URL=http://gitea:3000
GITEA_ADMIN_TOKEN=
GITEA_ALIAS_ADMIN_TO=admin

# Gitea 管理员配置
GITEA_ADMIN_USER=admin
GITEA_ADMIN_PASSWORD=admin123
GITEA_ADMIN_EMAIL=admin@example.com
GITEA_ADMIN_FULL_NAME=Administrator

# Gitea URL 配置 (动态生成)
ROOT_URL=${EXTERNAL_SCHEME}://${EXTERNAL_HOST}:${EXTERNAL_PORT}/gitea/
SUBURL=/gitea
STATIC_URL_PREFIX=/assets

# Gitea 反向代理认证
REVERSE_PROXY_TRUSTED_PROXIES=0.0.0.0/0,::/0
GITEA__auth__REVERSE_PROXY_AUTHENTICATION_USER=X-WEBAUTH-USER
GITEA__auth__REVERSE_PROXY_AUTHENTICATION_EMAIL=X-WEBAUTH-EMAIL
GITEA__auth__REVERSE_PROXY_AUTHENTICATION_FULL_NAME=X-WEBAUTH-FULLNAME
GITEA__auth__PROXY_ENABLED=true
GITEA__auth__PROXY_HEADER_NAME=X-WEBAUTH-USER
GITEA__auth__PROXY_EMAIL_HEADER=X-WEBAUTH-EMAIL
GITEA__auth__PROXY_FULL_NAME_HEADER=X-WEBAUTH-FULLNAME

# Gitea 安全配置
GITEA__security__REVERSE_PROXY_LIMIT=1
GITEA__security__REVERSE_PROXY_TRUSTED_PROXIES=0.0.0.0/0,::/0
DISABLE_REGISTRATION=false

# Gitea 自动同步配置
GITEA_AUTO_CREATE=true
GITEA_AUTO_UPDATE=true
GITEA_SYNC_ENABLED=true
GITEA_SYNC_INTERVAL_SECONDS=600

# Gitea 初始管理员
INITIAL_ADMIN_USERNAME=admin

# ==================== SaltStack 配置 ====================
# SaltStack Master 主机地址 (容器名或IP地址)
SALTSTACK_MASTER_HOST=saltstack

# SaltStack Master API URL (包含协议和端口)
SALTSTACK_MASTER_URL=http://saltstack:8002

# SaltStack API 认证令牌 (可选，如果启用了API认证)
SALTSTACK_API_TOKEN=

# SaltStack Master 端口配置
SALT_MASTER_HOST=saltstack
SALT_MASTER_PORT=4505
SALT_RETURN_PORT=4506
SALT_API_PORT=8002

# SaltStack API 认证配置
SALT_API_USERNAME=saltapi
SALT_API_PASSWORD=
SALT_API_EAUTH=file

# ==================== SLURM 配置 ====================
# SLURM 集群配置
SLURM_CLUSTER_NAME=ai-infra-cluster
SLURM_CONTROLLER_HOST=slurm-master
SLURM_CONTROLLER_PORT=6817
SLURM_SLURMDBD_HOST=slurm-master
SLURM_SLURMDBD_PORT=6819

# SLURM 数据库配置 (使用主PostgreSQL数据库)
SLURM_DB_HOST=mysql
SLURM_DB_PORT=3306
SLURM_DB_NAME=slurm_acct_db
SLURM_DB_USER=slurm
SLURM_DB_PASSWORD=slurm123

# SLURM 认证配置
SLURM_AUTH_TYPE=auth/munge
SLURM_MUNGE_KEY=ai-infra-slurm-munge-key-dev

# SLURM 集群节点配置
SLURM_PARTITION_NAME=compute
SLURM_DEFAULT_PARTITION=compute
SLURM_NODE_PREFIX=compute
SLURM_NODE_COUNT=3

# SLURM 测试节点配置
SLURM_TEST_NODES=${SLURM_TEST_NODES:-test-ssh01,test-ssh02,test-ssh03}
SLURM_TEST_NODE_CPUS=4
SLURM_TEST_NODE_MEMORY=8192

# SLURM 作业配置
SLURM_MAX_JOB_COUNT=10000
SLURM_MAX_ARRAY_SIZE=1000
SLURM_DEFAULT_TIME_LIMIT=01:00:00
SLURM_MAX_TIME_LIMIT=24:00:00

# SLURM Operator 配置
SLURM_OPERATOR_ENABLED=false
SLURM_WATCH_NAMESPACE=ai-infra
SLURM_ACCOUNTING_WORKERS=4
SLURM_CONTROLLER_WORKERS=4
SLURM_LOGINSET_WORKERS=4
SLURM_NODESET_WORKERS=4
SLURM_RESTAPI_WORKERS=4
SLURM_TOKEN_WORKERS=4
SLURM_SLURMCLIENT_WORKERS=2
SLURM_LOG_LEVEL=info
SLURM_WEBHOOK_TIMEOUT=10
SLURM_WEBHOOK_LOG_LEVEL=info

# ==================== 后端服务配置 ====================
# 后端 API 配置
BACKEND_HOST=backend
BACKEND_PORT=8082
DB_HOST=postgres
DB_PORT=5432

# 前端配置
FRONTEND_HOST=frontend
FRONTEND_PORT=80

# ==================== Nginx 配置 ====================
# Nginx 服务配置
NGINX_HOST=nginx
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# ==================== Kubernetes 配置 (Helm 部署) ====================
# K8s 资源配置
K8S_NAMESPACE=ai-infra
K8S_STORAGE_CLASS=standard
K8S_INGRESS_ENABLED=false
K8S_LOAD_BALANCER_ENABLED=true

# 资源限制
DEFAULT_CPU_REQUEST=100m
DEFAULT_CPU_LIMIT=500m
DEFAULT_MEMORY_REQUEST=128Mi
DEFAULT_MEMORY_LIMIT=512Mi

# 副本数配置
BACKEND_REPLICAS=1
FRONTEND_REPLICAS=1
NGINX_REPLICAS=1

# ==================== 监控配置 ====================
# 健康检查配置
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3

# 日志配置
LOG_FORMAT=json
LOG_OUTPUT=stdout
LOG_ROTATION_ENABLED=true
LOG_MAX_SIZE=100m
LOG_MAX_FILES=10

# ==================== 开发配置 ====================
# 开发模式配置
DEV_MODE=true
HOT_RELOAD_ENABLED=true
DEBUG_PORTS_ENABLED=true

# 测试配置
ENABLE_TESTING=false
TEST_DATABASE_URL=postgresql://test:test@postgres:5432/test_db
