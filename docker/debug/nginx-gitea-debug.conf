server {
    listen 80;
    server_name _;

    # Normalize /gitea -> /gitea/
    location = /gitea { return 302 /gitea/; }

    # Map /gitea/assets/* to upstream /assets/*
    location ^~ /gitea/assets/ {
        proxy_pass http://gitea:3000/assets/;
        proxy_set_header Host gitea:3000;
    }

    # Strip /gitea prefix for all other paths
    location ^~ /gitea/ {
        rewrite ^/gitea(/.*)$ $1 break;
        proxy_pass http://gitea:3000;
        proxy_set_header Host gitea:3000;
    }

    # Convenience root -> /gitea/
    location = / { return 302 /gitea/; }
}
