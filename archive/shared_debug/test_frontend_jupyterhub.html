<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JupyterHubå‰ç«¯è®¿é—®æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-button { padding: 10px 20px; margin: 10px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #40a9ff; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª JupyterHubå‰ç«¯è®¿é—®æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. æ¨¡æ‹Ÿå‰ç«¯Layoutèœå•ç‚¹å‡»</h3>
            <button class="test-button" onclick="testLayoutMenuClick()">
                ç‚¹å‡»JupyterHubèœå•é¡¹
            </button>
            <div id="layout-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. æ¨¡æ‹ŸJupyterHubSSOç»„ä»¶è®¿é—®</h3>
            <button class="test-button" onclick="testJupyterHubSSO()">
                ä½¿ç”¨JupyterHubSSOç»„ä»¶è®¿é—®
            </button>
            <div id="sso-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. æ¨¡æ‹ŸUnifiedJupyterHubIntegrationè®¿é—®</h3>
            <button class="test-button" onclick="testUnifiedIntegration()">
                ä½¿ç”¨ç»Ÿä¸€é›†æˆç»„ä»¶è®¿é—®
            </button>
            <div id="unified-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. ç›´æ¥URLè®¿é—®æµ‹è¯•</h3>
            <button class="test-button" onclick="testDirectAccess()">
                ç›´æ¥è®¿é—® /jupyterhub
            </button>
            <div id="direct-result" class="result"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸlocalStorageä¸­çš„token (ç”¨äºæµ‹è¯•)
        const mockToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test.token';
        
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#52c41a' : type === 'error' ? '#f5222d' : '#1890ff';
            element.innerHTML = `<span style="color: ${color}">[${timestamp}] ${message}</span>`;
        }
        
        function testLayoutMenuClick() {
            logResult('layout-result', 'æ¨¡æ‹ŸLayoutç»„ä»¶handleMenuClickå‡½æ•°...', 'info');
            
            // æ¨¡æ‹ŸLayoutç»„ä»¶ä¸­çš„handleMenuClické€»è¾‘
            const token = localStorage.getItem('token');
            setTimeout(() => {
                if (token) {
                    logResult('layout-result', 'æ£€æµ‹åˆ°tokenï¼Œå°†è·³è½¬åˆ°: /jupyterhub-authenticated', 'success');
                    // å®é™…ä»£ç : window.location.href = '/jupyterhub-authenticated';
                } else {
                    logResult('layout-result', 'æœªæ£€æµ‹åˆ°tokenï¼Œå°†è·³è½¬åˆ°: /sso/?redirect_uri=/jupyterhub-authenticated', 'success');
                    // å®é™…ä»£ç : window.location.href = '/sso/?redirect_uri=/jupyterhub-authenticated';
                }
            }, 500);
        }
        
        function testJupyterHubSSO() {
            logResult('sso-result', 'æ¨¡æ‹ŸJupyterHubSSOç»„ä»¶handleJupyterHubAccess...', 'info');
            
            // æ¨¡æ‹Ÿè®¤è¯æ£€æŸ¥
            setTimeout(async () => {
                try {
                    // æ¨¡æ‹ŸcheckSSOStatuså‡½æ•°
                    const token = localStorage.getItem('token');
                    if (!token) {
                        logResult('sso-result', 'æœªæ‰¾åˆ°tokenï¼Œå°†è·³è½¬åˆ°SSOç™»å½•', 'success');
                        return;
                    }
                    
                    // æ¨¡æ‹ŸtokenéªŒè¯ (å®é™…ä¼šè°ƒç”¨API)
                    logResult('sso-result', 'è®¤è¯æˆåŠŸï¼Œå°†è·³è½¬åˆ°: /jupyterhub-authenticated', 'success');
                    
                } catch (error) {
                    logResult('sso-result', 'è®¤è¯å¤±è´¥ï¼Œå°†è·³è½¬åˆ°SSOç™»å½•', 'error');
                }
            }, 500);
        }
        
        function testUnifiedIntegration() {
            logResult('unified-result', 'æ¨¡æ‹ŸUnifiedJupyterHubIntegrationç»„ä»¶handleUnifiedLogin...', 'info');
            
            setTimeout(() => {
                const token = localStorage.getItem('token');
                if (!token) {
                    logResult('unified-result', 'æœªæ‰¾åˆ°tokenï¼Œå°†è·³è½¬åˆ°: /sso/?redirect_uri=/jupyterhub-authenticated', 'success');
                } else {
                    logResult('unified-result', 'æ‰¾åˆ°tokenï¼Œå°†è·³è½¬åˆ°: /jupyterhub-authenticated', 'success');
                }
            }, 500);
        }
        
        function testDirectAccess() {
            logResult('direct-result', 'æµ‹è¯•ç›´æ¥è®¿é—® /jupyterhub...', 'info');
            
            fetch('/jupyterhub', { method: 'HEAD' })
                .then(response => {
                    if (response.redirected) {
                        logResult('direct-result', `æœåŠ¡å™¨é‡å®šå‘åˆ°: ${response.url}`, 'success');
                    } else {
                        logResult('direct-result', `è¿”å›çŠ¶æ€: ${response.status}`, 'info');
                    }
                })
                .catch(error => {
                    logResult('direct-result', `è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                });
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰tokençŠ¶æ€
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                console.log('å½“å‰localStorageä¸­æœ‰token:', token.substring(0, 20) + '...');
            } else {
                console.log('å½“å‰localStorageä¸­æ²¡æœ‰token');
            }
        };
        
        // æ·»åŠ ä¸€ä¸ªè®¾ç½®æµ‹è¯•tokençš„æŒ‰é’®
        document.querySelector('.test-container').insertAdjacentHTML('afterbegin', `
            <div class="test-section">
                <h3>ğŸ”§ æµ‹è¯•å·¥å…·</h3>
                <button class="test-button" onclick="setTestToken()">è®¾ç½®æµ‹è¯•Token</button>
                <button class="test-button" onclick="clearToken()">æ¸…é™¤Token</button>
                <div id="token-status" class="result">TokençŠ¶æ€: ${localStorage.getItem('token') ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</div>
            </div>
        `);
        
        function setTestToken() {
            localStorage.setItem('token', mockToken);
            document.getElementById('token-status').innerHTML = 'TokençŠ¶æ€: å·²è®¾ç½® âœ…';
        }
        
        function clearToken() {
            localStorage.removeItem('token');
            document.getElementById('token-status').innerHTML = 'TokençŠ¶æ€: æœªè®¾ç½® âŒ';
        }
    </script>
</body>
</html>
