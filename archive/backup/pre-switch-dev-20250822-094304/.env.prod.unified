# ====================================================================
# AI Infrastructure Matrix - 生产环境配置
# ====================================================================
# 版本: v3.1.0
# 环境: Production
# 说明: 生产环境安全配置，所有密码和密钥需要在部署前修改
# ====================================================================

# ==================== 基础配置 ====================
# 项目名称
COMPOSE_PROJECT_NAME=ai-infra-matrix-prod

# 镜像版本标签
IMAGE_TAG=v0.3.5

# 环境类型
BUILD_ENV=production
DEBUG_MODE=false
LOG_LEVEL=info

# 环境文件配置
ENV_FILE=.env.prod

# 时区设置
TZ=Asia/Shanghai

# 域名配置 (需要修改为实际域名)
DOMAIN=your-domain.com
NGINX_PORT=80

# ==================== 数据库配置 ====================
# PostgreSQL 配置 (生产环境密码需要修改)
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=ansible_playbook_generator
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_IN_PRODUCTION_PostgreSQL_2024!

# PostgreSQL JupyterHub 数据库
JUPYTERHUB_DB_NAME=jupyterhub_db
JUPYTERHUB_DB_USER=postgres
JUPYTERHUB_DB_PASSWORD=CHANGE_IN_PRODUCTION_PostgreSQL_2024!

# Gitea 数据库配置
GITEA_DB_TYPE=postgres
GITEA_DB_HOST=postgres:5432
GITEA_DB_NAME=gitea
GITEA_DB_USER=gitea
GITEA_DB_PASSWD=CHANGE_IN_PRODUCTION_Gitea_DB_2024!

# ==================== 缓存配置 ====================
# Redis 配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_IN_PRODUCTION_Redis_2024!
REDIS_DB=0
REDIS_CACHE_DB=1

# ==================== LDAP 配置 ====================
# OpenLDAP 配置 (生产环境密码需要修改)
LDAP_SERVER=openldap
LDAP_PORT=389
LDAP_BASE_DN=dc=ai-infra,dc=com
LDAP_BIND_DN=cn=admin,dc=ai-infra,dc=com
LDAP_ADMIN_PASSWORD=CHANGE_IN_PRODUCTION_LDAP_2024!
LDAP_CONFIG_PASSWORD=CHANGE_IN_PRODUCTION_LDAP_Config_2024!

# LDAP 用户管理
LDAP_USER_BASE=ou=users,dc=ai-infra,dc=com
LDAP_GROUP_BASE=ou=groups,dc=ai-infra,dc=com
LDAP_USER_FILTER=(uid=%s)
LDAP_ADMIN_GROUP=administrators

# ==================== 存储配置 ====================
# MinIO S3 兼容存储 (生产环境密钥需要修改)
MINIO_HOST=minio
MINIO_PORT=9000
MINIO_ACCESS_KEY=CHANGE_IN_PRODUCTION_MINIO_ACCESS
MINIO_SECRET_KEY=CHANGE_IN_PRODUCTION_MINIO_SECRET_2024!
MINIO_BUCKET_DEFAULT=ai-infra
MINIO_BUCKET_GITEA=gitea
MINIO_BUCKET_JUPYTER=jupyter

# 存储类型选择
STORAGE_TYPE=minio
GITEA_STORAGE=minio

# ==================== 认证配置 ====================
# JWT 配置 (生产环境密钥需要修改)
JWT_SECRET=CHANGE_IN_PRODUCTION_JWT_SECRET_2024_RANDOM_STRING_HERE
JWT_EXPIRY=4h
JWT_REFRESH_EXPIRY=24h

# Session 配置
SESSION_SECRET=CHANGE_IN_PRODUCTION_SESSION_SECRET_2024_RANDOM_STRING
SESSION_TIMEOUT=14400

# OAuth 配置
OAUTH_ENABLED=false
OAUTH_CLIENT_ID=
OAUTH_CLIENT_SECRET=
OAUTH_REDIRECT_URL=

# ==================== JupyterHub 配置 ====================
# JupyterHub 基础配置
JUPYTERHUB_HOST=jupyterhub
JUPYTERHUB_PORT=8000
CONFIGPROXY_AUTH_TOKEN=CHANGE_IN_PRODUCTION_PROXY_TOKEN_2024_RANDOM
JUPYTERHUB_CRYPT_KEY=CHANGE_IN_PRODUCTION_CRYPT_KEY_64_CHAR_HEX_STRING_HERE
JUPYTERHUB_ADMIN_USERS=admin

# JupyterHub 镜像配置
JUPYTERHUB_IMAGE=ai-infra-singleuser:v0.3.5
JUPYTERHUB_NETWORK=ai-infra-network

# JupyterHub 资源限制
JUPYTERHUB_MEM_LIMIT=4G
JUPYTERHUB_CPU_LIMIT=2.0

# JupyterHub 自动清理
JUPYTERHUB_IDLE_CULLER_ENABLED=true
JUPYTERHUB_IDLE_TIMEOUT=1800
JUPYTERHUB_CULL_TIMEOUT=3600

# JupyterHub 集成配置
JUPYTERHUB_AUTO_LOGIN=false
JUPYTERHUB_DEV_MODE=false
USE_CUSTOM_AUTH=true
AI_INFRA_BACKEND_URL=http://backend:8082
AI_INFRA_API_TOKEN=CHANGE_IN_PRODUCTION_API_TOKEN_2024

# JupyterHub 网络配置
JUPYTERHUB_USE_PROXY=true
JUPYTERHUB_PUBLIC_HOST=your-domain.com
JUPYTERHUB_CORS_ORIGIN=https://your-domain.com

# JupyterHub 调试配置
JUPYTERHUB_DEBUG=false
JUPYTERHUB_LOG_LEVEL=INFO
JUPYTERHUB_ACCESS_LOG=true

# ==================== Gitea 配置 ====================
# Gitea 基础配置
GITEA_ENABLED=true
GITEA_HOST=gitea
GITEA_PORT=3000
GITEA_BASE_URL=http://gitea:3000
GITEA_ADMIN_TOKEN=CHANGE_IN_PRODUCTION_GITEA_TOKEN_2024
GITEA_ALIAS_ADMIN_TO=admin

# Gitea 管理员配置 (生产环境密码需要修改)
GITEA_ADMIN_USER=admin
GITEA_ADMIN_PASSWORD=CHANGE_IN_PRODUCTION_Gitea_Admin_2024!
GITEA_ADMIN_EMAIL=admin@your-domain.com
GITEA_ADMIN_FULL_NAME=Administrator

# Gitea URL 配置
ROOT_URL=https://your-domain.com/gitea/
SUBURL=/gitea
STATIC_URL_PREFIX=/assets

# Gitea 反向代理认证
REVERSE_PROXY_TRUSTED_PROXIES=172.16.0.0/12,192.168.0.0/16,10.0.0.0/8
GITEA__auth__REVERSE_PROXY_AUTHENTICATION_USER=X-WEBAUTH-USER
GITEA__auth__REVERSE_PROXY_AUTHENTICATION_EMAIL=X-WEBAUTH-EMAIL
GITEA__auth__REVERSE_PROXY_AUTHENTICATION_FULL_NAME=X-WEBAUTH-FULLNAME
GITEA__auth__PROXY_ENABLED=true
GITEA__auth__PROXY_HEADER_NAME=X-WEBAUTH-USER
GITEA__auth__PROXY_EMAIL_HEADER=X-WEBAUTH-EMAIL
GITEA__auth__PROXY_FULL_NAME_HEADER=X-WEBAUTH-FULLNAME

# Gitea 安全配置
GITEA__security__REVERSE_PROXY_LIMIT=1
GITEA__security__REVERSE_PROXY_TRUSTED_PROXIES=172.16.0.0/12,192.168.0.0/16,10.0.0.0/8
DISABLE_REGISTRATION=true

# Gitea 自动同步配置
GITEA_AUTO_CREATE=false
GITEA_AUTO_UPDATE=false
GITEA_SYNC_ENABLED=false
GITEA_SYNC_INTERVAL_SECONDS=3600

# Gitea 初始管理员
INITIAL_ADMIN_USERNAME=admin

# ==================== SaltStack 配置 ====================
# SaltStack 配置
SALT_MASTER_HOST=saltstack
SALT_MASTER_PORT=4505
SALT_RETURN_PORT=4506
SALT_API_PORT=8000

# ==================== 后端服务配置 ====================
# 后端 API 配置
BACKEND_HOST=backend
BACKEND_PORT=8082
DB_HOST=postgres
DB_PORT=5432

# 前端配置
FRONTEND_HOST=frontend
FRONTEND_PORT=80

# ==================== Nginx 配置 ====================
# Nginx 服务配置
NGINX_HOST=nginx
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# ==================== Kubernetes 配置 (Helm 部署) ====================
# K8s 资源配置
K8S_NAMESPACE=ai-infra-prod
K8S_STORAGE_CLASS=standard
K8S_INGRESS_ENABLED=true
K8S_LOAD_BALANCER_ENABLED=false

# 资源限制 (生产环境更高配置)
DEFAULT_CPU_REQUEST=200m
DEFAULT_CPU_LIMIT=1000m
DEFAULT_MEMORY_REQUEST=256Mi
DEFAULT_MEMORY_LIMIT=1Gi

# 副本数配置 (生产环境高可用)
BACKEND_REPLICAS=3
FRONTEND_REPLICAS=2
NGINX_REPLICAS=2

# ==================== 监控配置 ====================
# 健康检查配置
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3

# 日志配置
LOG_FORMAT=json
LOG_OUTPUT=file
LOG_ROTATION_ENABLED=true
LOG_MAX_SIZE=100m
LOG_MAX_FILES=30

# ==================== 生产安全配置 ====================
# 生产模式配置
DEV_MODE=false
HOT_RELOAD_ENABLED=false
DEBUG_PORTS_ENABLED=false

# 测试配置
ENABLE_TESTING=false
TEST_DATABASE_URL=

# SSL/TLS 配置
SSL_ENABLED=true
SSL_REDIRECT=true
HSTS_ENABLED=true
SECURE_HEADERS_ENABLED=true

# 备份配置
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30

# 安全限制
RATE_LIMITING_ENABLED=true
CORS_STRICT_MODE=true
CSRF_PROTECTION_ENABLED=true
