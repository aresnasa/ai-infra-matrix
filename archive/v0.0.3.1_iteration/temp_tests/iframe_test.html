<!DOCTYPE html>
<html>
<head>
    <title>iframeæµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-frame { width: 100%; height: 600px; border: 2px solid #ccc; }
        .status { 
            margin: 10px 0; 
            padding: 10px; 
            background: #f5f5f5; 
            border-left: 4px solid #ccc;
        }
        .status.loaded { background: #e8f5e8; border-left-color: #4caf50; }
        .status.error { background: #ffe8e8; border-left-color: #f44336; }
        .status.accessible { background: #e8f4fd; border-left-color: #2196f3; }
        .status.blocked { background: #fff3e0; border-left-color: #ff9800; }
    </style>
</head>
<body>
    <h1>ğŸ§ª JupyterHub iframeæµ‹è¯•</h1>
    
    <div class="status">
        <strong>æµ‹è¯•è¯´æ˜:</strong> å¦‚æœä¸‹é¢çš„iframeæ˜¾ç¤ºJupyterHubå†…å®¹ï¼Œè¯´æ˜iframeåŠŸèƒ½æ­£å¸¸ã€‚
    </div>
    
    <h2>æµ‹è¯•1: ç›´æ¥iframeåµŒå…¥</h2>
    <iframe 
        id="test-frame-1" 
        class="test-frame"
        src="http://localhost:8080/jupyter/hub/"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒiframe
    </iframe>
    
    <h2>æµ‹è¯•2: ä½¿ç”¨wrapperé¡µé¢</h2>
    <iframe 
        id="test-frame-2" 
        class="test-frame"
        src="http://localhost:8080/jupyterhub"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒiframe
    </iframe>
    
    <script>
        // ç›‘å¬iframeåŠ è½½äº‹ä»¶
        function setupIframeMonitoring(iframeId, name) {
            const iframe = document.getElementById(iframeId);
            
            iframe.onload = function() {
                console.log(`${name} - iframeåŠ è½½å®Œæˆ`);
                updateStatus(iframeId, 'loaded');
                
                try {
                    // å°è¯•è®¿é—®iframeå†…å®¹ï¼ˆå¯èƒ½å› ä¸ºåŒæºç­–ç•¥è€Œå¤±è´¥ï¼‰
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    console.log(`${name} - å¯ä»¥è®¿é—®iframeå†…å®¹`);
                    updateStatus(iframeId, 'accessible');
                } catch (e) {
                    console.log(`${name} - æ— æ³•è®¿é—®iframeå†…å®¹ï¼ˆæ­£å¸¸çš„è·¨åŸŸé™åˆ¶ï¼‰: ${e.message}`);
                    updateStatus(iframeId, 'blocked');
                }
            };
            
            iframe.onerror = function() {
                console.error(`${name} - iframeåŠ è½½é”™è¯¯`);
                updateStatus(iframeId, 'error');
            };
        }
        
        function updateStatus(iframeId, status) {
            const statusDiv = document.getElementById(`status-${iframeId}`);
            if (statusDiv) {
                statusDiv.innerHTML = `çŠ¶æ€: ${status}`;
                statusDiv.className = `status ${status}`;
            }
        }
        
        // åˆ›å»ºçŠ¶æ€æ˜¾ç¤ºå…ƒç´ 
        function createStatusElements() {
            const iframe1 = document.getElementById('test-frame-1');
            const iframe2 = document.getElementById('test-frame-2');
            
            // ä¸ºæ¯ä¸ªiframeæ·»åŠ çŠ¶æ€æ˜¾ç¤º
            [iframe1, iframe2].forEach(iframe => {
                const statusDiv = document.createElement('div');
                statusDiv.id = `status-${iframe.id}`;
                statusDiv.className = 'status';
                statusDiv.innerHTML = 'çŠ¶æ€: ç­‰å¾…åŠ è½½...';
                iframe.parentNode.insertBefore(statusDiv, iframe);
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            createStatusElements();
            setupIframeMonitoring('test-frame-1', 'ç›´æ¥åµŒå…¥');
            setupIframeMonitoring('test-frame-2', 'Wrapperé¡µé¢');
            
            // 5ç§’åæ£€æŸ¥iframeçŠ¶æ€
            setTimeout(() => {
                ['test-frame-1', 'test-frame-2'].forEach((id, index) => {
                    const iframe = document.getElementById(id);
                    const name = index === 0 ? 'ç›´æ¥åµŒå…¥' : 'Wrapperé¡µé¢';
                    
                    if (iframe.contentWindow) {
                        console.log(`${name} - iframeçª—å£å­˜åœ¨`);
                        
                        // å°è¯•æ£€æŸ¥iframeæ˜¯å¦çœŸçš„åŠ è½½äº†å†…å®¹
                        try {
                            const currentSrc = iframe.src;
                            console.log(`${name} - iframeå½“å‰src: ${currentSrc}`);
                            
                            // æ£€æŸ¥iframeæ˜¯å¦æ˜¾ç¤ºç©ºç™½
                            const rect = iframe.getBoundingClientRect();
                            console.log(`${name} - iframeå°ºå¯¸: ${rect.width}x${rect.height}`);
                        } catch (e) {
                            console.log(`${name} - æ£€æŸ¥iframeè¯¦æƒ…å¤±è´¥: ${e.message}`);
                        }
                    } else {
                        console.log(`${name} - iframeçª—å£ä¸å­˜åœ¨`);
                    }
                });
                
                // æ·»åŠ è°ƒè¯•ä¿¡æ¯åˆ°é¡µé¢
                const debugInfo = document.createElement('div');
                debugInfo.innerHTML = `
                    <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
                    <p><strong>æ—¶é—´:</strong> ${new Date().toLocaleTimeString()}</p>
                    <p><strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent}</p>
                    <p><strong>é¡µé¢URL:</strong> ${window.location.href}</p>
                    <p>è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</p>
                `;
                debugInfo.style.background = '#f0f0f0';
                debugInfo.style.padding = '10px';
                debugInfo.style.margin = '20px 0';
                document.body.appendChild(debugInfo);
                
            }, 5000);
        });
    </script>
</body>
</html>