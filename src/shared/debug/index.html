<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŸºç¡€è®¾æ–½çŸ©é˜µ - è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .tool-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .tool-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .tool-title {
            color: #1890ff;
            margin: 0 0 15px 0;
            font-size: 18px;
        }
        .tool-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .tool-link {
            display: inline-block;
            background: #1890ff;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.3s;
            margin-right: 10px;
        }
        .tool-link:hover {
            background: #40a9ff;
        }
        .tool-link.secondary {
            background: #f5f5f5;
            color: #666;
        }
        .tool-link.secondary:hover {
            background: #e6e6e6;
        }
        .status-card {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #52c41a; }
        .status-offline { background: #ff4d4f; }
        .status-warning { background: #faad14; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ› ï¸ AIåŸºç¡€è®¾æ–½çŸ©é˜µè°ƒè¯•å·¥å…·</h1>
        <p>ç”¨äºè°ƒè¯•å’Œæµ‹è¯•SSOè®¤è¯ã€JupyterHubé›†æˆç­‰åŠŸèƒ½çš„å·¥å…·é›†åˆ</p>
    </div>

    <div class="status-card">
        <h3>ğŸ” ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
        <div id="system-status">æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</div>
    </div>

    <div class="tools-grid">
        <div class="tool-card">
            <h3 class="tool-title">ğŸ” SSOè®¤è¯ä¿®å¤å·¥å…·</h3>
            <p class="tool-description">æ¸…ç†mock tokenï¼Œæµ‹è¯•çœŸå®JWTè®¤è¯æµç¨‹ï¼Œä¿®å¤SSOé‡å®šå‘é—®é¢˜</p>
            <a href="fix_sso_mock_token.html" class="tool-link">å¯åŠ¨ä¿®å¤å·¥å…·</a>
            <a href="sso-fix-complete.html" class="tool-link secondary">æŸ¥çœ‹ä¿®å¤æŠ¥å‘Š</a>
        </div>

        <div class="tool-card">
            <h3 class="tool-title">ğŸ§ª ç«¯åˆ°ç«¯æµ‹è¯•</h3>
            <p class="tool-description">å®Œæ•´çš„è®¤è¯æµç¨‹æµ‹è¯•ï¼ŒåŒ…æ‹¬ç™»å½•ã€tokenéªŒè¯ã€JupyterHubè®¿é—®ç­‰</p>
            <a href="end_to_end_test.html" class="tool-link">å¼€å§‹æµ‹è¯•</a>
        </div>

        <div class="tool-card">
            <h3 class="tool-title">ğŸ“‹ SSOé‡å®šå‘è¯Šæ–­</h3>
            <p class="tool-description">è¯Šæ–­å’Œä¿®å¤SSOé‡å®šå‘å‚æ•°é—®é¢˜ï¼ŒéªŒè¯redirect_uriå¤„ç†é€»è¾‘</p>
            <a href="fix-sso-auth.html" class="tool-link">è¯Šæ–­å·¥å…·</a>
        </div>

        <div class="tool-card">
            <h3 class="tool-title">ğŸ”— JupyterHubè®¤è¯æ¡¥æ¥</h3>
            <p class="tool-description">æµ‹è¯•JupyterHubè®¤è¯æ¡¥æ¥é¡µé¢ï¼ŒéªŒè¯tokenä¼ é€’å’ŒéªŒè¯æµç¨‹</p>
            <a href="/jupyterhub-authenticated" class="tool-link">æµ‹è¯•æ¡¥æ¥</a>
            <a href="/sso/?redirect_uri=/jupyterhub-authenticated" class="tool-link secondary">æµ‹è¯•SSOæµç¨‹</a>
        </div>

        <div class="tool-card">
            <h3 class="tool-title">ğŸŒ ç³»ç»Ÿè®¿é—®å…¥å£</h3>
            <p class="tool-description">å¿«é€Ÿè®¿é—®ç³»ç»Ÿçš„å„ä¸ªå…³é”®é¡µé¢å’ŒæœåŠ¡</p>
            <a href="/" class="tool-link">å‰ç«¯é¦–é¡µ</a>
            <a href="/sso/" class="tool-link secondary">SSOç™»å½•</a>
            <a href="/jupyterhub" class="tool-link secondary">JupyterHub</a>
        </div>

        <div class="tool-card">
            <h3 class="tool-title">ğŸ“Š APIæµ‹è¯•å·¥å…·</h3>
            <p class="tool-description">æµ‹è¯•åç«¯APIæ¥å£ï¼ŒéªŒè¯è®¤è¯ã€ç”¨æˆ·ç®¡ç†ç­‰åŠŸèƒ½</p>
            <a href="#" onclick="testAPI()" class="tool-link">æµ‹è¯•API</a>
            <a href="#" onclick="checkAuth()" class="tool-link secondary">æ£€æŸ¥è®¤è¯çŠ¶æ€</a>
        </div>
    </div>

    <div class="tool-card" style="margin-top: 30px;">
        <h3 class="tool-title">ğŸ“ å®æ—¶æ—¥å¿—</h3>
        <div id="debug-log" style="background: #f5f5f5; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
            [è°ƒè¯•æ—¥å¿—å°†åœ¨æ­¤å¤„æ˜¾ç¤º]
        </div>
        <button onclick="clearLog()" class="tool-link secondary" style="margin-top: 10px; border: none; cursor: pointer;">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('debug-log');
            const color = type === 'error' ? 'color: #ff4d4f;' : 
                         type === 'success' ? 'color: #52c41a;' : 
                         type === 'warning' ? 'color: #faad14;' : 'color: #666;';
            
            const logEntry = `<div style="${color}">[${timestamp}] ${message}</div>`;
            logDiv.innerHTML += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('debug-log').innerHTML = '[è°ƒè¯•æ—¥å¿—å·²æ¸…ç©º]';
        }

        async function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            const services = [
                { name: 'å‰ç«¯æœåŠ¡', url: '/', key: 'frontend' },
                { name: 'SSOæœåŠ¡', url: '/sso/', key: 'sso' },
                { name: 'åç«¯API', url: '/api/auth/verify', key: 'backend' },
                { name: 'JupyterHubæ¡¥æ¥', url: '/jupyterhub-authenticated', key: 'jupyter' }
            ];

            let statusHTML = '';

            for (const service of services) {
                try {
                    const response = await fetch(service.url, { method: 'HEAD' });
                    const status = response.ok ? 'online' : 'warning';
                    const statusText = response.ok ? 'æ­£å¸¸' : `HTTP ${response.status}`;
                    statusHTML += `<div><span class="status-indicator status-${status}"></span>${service.name}: ${statusText}</div>`;
                } catch (error) {
                    statusHTML += `<div><span class="status-indicator status-offline"></span>${service.name}: ç¦»çº¿</div>`;
                }
            }

            statusDiv.innerHTML = statusHTML;
        }

        async function testAPI() {
            log('å¼€å§‹APIæµ‹è¯•...', 'info');
            
            try {
                // æµ‹è¯•ç™»å½•API
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                if (loginResponse.ok) {
                    const data = await loginResponse.json();
                    log('âœ… ç™»å½•APIæµ‹è¯•æˆåŠŸ', 'success');
                    
                    // æµ‹è¯•éªŒè¯API
                    const verifyResponse = await fetch('/api/auth/verify', {
                        headers: { 'Authorization': `Bearer ${data.token}` }
                    });
                    
                    if (verifyResponse.ok) {
                        log('âœ… éªŒè¯APIæµ‹è¯•æˆåŠŸ', 'success');
                    } else {
                        log('âŒ éªŒè¯APIæµ‹è¯•å¤±è´¥', 'error');
                    }
                } else {
                    log('âŒ ç™»å½•APIæµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ APIæµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                log('âŒ æœªæ‰¾åˆ°è®¤è¯token', 'error');
                return;
            }

            try {
                const response = await fetch('/api/auth/verify', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… è®¤è¯æœ‰æ•ˆï¼Œç”¨æˆ·: ${data.username}`, 'success');
                } else {
                    log('âŒ è®¤è¯å·²å¤±æ•ˆ', 'error');
                }
            } catch (error) {
                log(`âŒ è®¤è¯æ£€æŸ¥å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        document.addEventListener('DOMContentLoaded', () => {
            log('è°ƒè¯•å·¥å…·å·²åˆå§‹åŒ–', 'info');
            checkSystemStatus();
            
            // æ¯30ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€
            setInterval(checkSystemStatus, 30000);
        });
    </script>
</body>
</html>
