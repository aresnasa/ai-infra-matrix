<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="cache-version" content="1754584220" data-version="dev">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JupyterHub iframeæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.loading { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ§ª JupyterHub iframeé›†æˆæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. ç›´æ¥è®¿é—®JupyterHub (iframe)</h2>
        <div id="direct-status" class="status loading">æ­£åœ¨åŠ è½½...</div>
        <iframe src="/jupyter/hub/" id="direct-frame"></iframe>
    </div>
    
    <div class="test-section">
        <h2>2. é€šè¿‡wrapperè®¿é—®JupyterHub (å¸¦è‡ªåŠ¨è®¤è¯)</h2>
        <div id="wrapper-status" class="status loading">æ­£åœ¨åŠ è½½...</div>
        <iframe src="/jupyterhub" id="wrapper-frame"></iframe>
    </div>

    <div class="test-section">
        <h2>3. æœåŠ¡çŠ¶æ€æ£€æŸ¥</h2>
        <div id="health-status" class="status loading">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkServices()">ğŸ”„ é‡æ–°æ£€æŸ¥</button>
    </div>

    <script>
        // æ£€æŸ¥iframeåŠ è½½çŠ¶æ€
        function setupFrameMonitoring(frameId, statusId) {
            const frame = document.getElementById(frameId);
            const status = document.getElementById(statusId);
            
            let loadTimeout = setTimeout(() => {
                status.className = 'status error';
                status.textContent = 'âš ï¸ åŠ è½½è¶…æ—¶ï¼ˆå¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœæ˜¾ç¤ºå†…å®¹ï¼‰';
            }, 10000);

            frame.onload = () => {
                clearTimeout(loadTimeout);
                status.className = 'status success';
                status.textContent = 'âœ… iframeå·²åŠ è½½';
            };

            frame.onerror = () => {
                clearTimeout(loadTimeout);
                status.className = 'status error';
                status.textContent = 'âŒ iframeåŠ è½½å¤±è´¥';
            };
        }

        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        async function checkServices() {
            const healthStatus = document.getElementById('health-status');
            healthStatus.className = 'status loading';
            healthStatus.textContent = 'æ£€æŸ¥ä¸­...';

            const services = [
                { name: 'JupyterHub API', url: '/jupyter/hub/api' },
                { name: 'åç«¯è®¤è¯API', url: '/api/auth/token' },
                { name: 'nginxå¥åº·æ£€æŸ¥', url: '/health' }
            ];

            let results = [];
            
            for (const service of services) {
                try {
                    const response = await fetch(service.url, { method: 'HEAD' });
                    results.push(`âœ… ${service.name}: ${response.status}`);
                } catch (error) {
                    results.push(`âŒ ${service.name}: ${error.message}`);
                }
            }

            healthStatus.className = 'status success';
            healthStatus.innerHTML = results.join('<br>');
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            setupFrameMonitoring('direct-frame', 'direct-status');
            setupFrameMonitoring('wrapper-frame', 'wrapper-status');
            checkServices();
        });
    </script>
</body>
</html>
