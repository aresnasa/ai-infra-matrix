<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JupyterHub iframe ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #4a5568;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .content {
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-header {
            background: #f7fafc;
            padding: 15px;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .test-content {
            padding: 20px;
        }
        
        iframe {
            width: 100%;
            height: 500px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .status.loading {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status.error {
            background: #fed7d7;
            color: #c53030;
        }
        
        .link-test {
            margin: 10px 0;
        }
        
        .link-test a {
            display: inline-block;
            padding: 10px 20px;
            background: #4299e1;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-right: 10px;
            transition: background 0.3s;
        }
        
        .link-test a:hover {
            background: #3182ce;
        }
        
        .info-box {
            background: #ebf4ff;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª JupyterHub iframe ä¿®å¤éªŒè¯æµ‹è¯•</h1>
            <p>æµ‹è¯•æ—¶é—´: <span id="timestamp"></span></p>
        </div>
        
        <div class="content">
            <div class="info-box">
                <strong>ä¿®å¤è¯´æ˜:</strong> 
                ä¿®å¤äº†Layout.jsä¸­çš„handleMenuClickå‡½æ•°ï¼Œç¡®ä¿JupyterHubèœå•é¡¹æ­£ç¡®å¤„ç†ç›´æ¥è·³è½¬ã€‚
                åŒæ—¶éªŒè¯nginxé…ç½®å’ŒCSPç­–ç•¥æ”¯æŒiframeåµŒå…¥ã€‚
            </div>
            
            <!-- æµ‹è¯•1: ç›´æ¥iframeåŠ è½½ -->
            <div class="test-section">
                <div class="test-header">
                    ğŸ“ æµ‹è¯•1: ç›´æ¥iframeåŠ è½½ JupyterHub
                </div>
                <div class="test-content">
                    <iframe 
                        id="direct-iframe" 
                        src="http://localhost:8080/jupyterhub"
                        title="ç›´æ¥JupyterHub iframe">
                    </iframe>
                    <div id="status-direct" class="status loading">
                        ğŸ”„ æ­£åœ¨åŠ è½½JupyterHub...
                    </div>
                </div>
            </div>
            
            <!-- æµ‹è¯•2: JupyterHub Hubè·¯å¾„ -->
            <div class="test-section">
                <div class="test-header">
                    ğŸ“ æµ‹è¯•2: JupyterHub Hubç™»å½•é¡µé¢
                </div>
                <div class="test-content">
                    <iframe 
                        id="hub-iframe" 
                        src="http://localhost:8080/jupyter/hub/login"
                        title="JupyterHub Hub iframe">
                    </iframe>
                    <div id="status-hub" class="status loading">
                        ğŸ”„ æ­£åœ¨åŠ è½½JupyterHub Hub...
                    </div>
                </div>
            </div>
            
            <!-- æµ‹è¯•3: å¯¼èˆªé“¾æ¥æµ‹è¯• -->
            <div class="test-section">
                <div class="test-header">
                    ğŸ“ æµ‹è¯•3: å¯¼èˆªé“¾æ¥æµ‹è¯•
                </div>
                <div class="test-content">
                    <div class="link-test">
                        <a href="http://localhost:8080/projects" target="_blank">
                            ğŸ  æ‰“å¼€Projectsé¡µé¢ (æ–°çª—å£)
                        </a>
                        <a href="http://localhost:8080/jupyterhub" target="_blank">
                            ğŸš€ æ‰“å¼€JupyterHub (æ–°çª—å£)
                        </a>
                        <a href="javascript:void(0)" onclick="loadInIframe()">
                            ğŸ”„ åœ¨iframeä¸­é‡æ–°åŠ è½½
                        </a>
                    </div>
                    <div id="navigation-status" class="status">
                        ç‚¹å‡»ä¸Šæ–¹é“¾æ¥æµ‹è¯•å¯¼èˆªåŠŸèƒ½
                    </div>
                </div>
            </div>
            
            <!-- æµ‹è¯•4: å®æ—¶çŠ¶æ€ç›‘æ§ -->
            <div class="test-section">
                <div class="test-header">
                    ğŸ“ æµ‹è¯•4: å®æ—¶çŠ¶æ€ç›‘æ§
                </div>
                <div class="test-content">
                    <div id="realtime-status">
                        <div>æµ‹è¯•å¼€å§‹æ—¶é—´: <span id="start-time"></span></div>
                        <div>iframeåŠ è½½çŠ¶æ€: <span id="load-status">æ£€æµ‹ä¸­...</span></div>
                        <div>å†…å®¹æ£€æµ‹ç»“æœ: <span id="content-status">ç­‰å¾…ä¸­...</span></div>
                        <div>ç½‘ç»œçŠ¶æ€: <span id="network-status">æ£€æŸ¥ä¸­...</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è®¾ç½®æ—¶é—´æˆ³
        document.getElementById('timestamp').textContent = new Date().toLocaleString('zh-CN');
        document.getElementById('start-time').textContent = new Date().toLocaleString('zh-CN');
        
        // iframeåŠ è½½çŠ¶æ€ç›‘æ§
        function setupIframeMonitoring() {
            const directIframe = document.getElementById('direct-iframe');
            const hubIframe = document.getElementById('hub-iframe');
            
            // ç›‘æ§ç›´æ¥iframe
            directIframe.onload = function() {
                console.log('ç›´æ¥iframeåŠ è½½å®Œæˆ');
                updateStatus('status-direct', 'âœ… JupyterHubåŠ è½½æˆåŠŸ', 'success');
                checkIframeContent('direct-iframe', 'status-direct');
            };
            
            directIframe.onerror = function() {
                console.log('ç›´æ¥iframeåŠ è½½å¤±è´¥');
                updateStatus('status-direct', 'âŒ JupyterHubåŠ è½½å¤±è´¥', 'error');
            };
            
            // ç›‘æ§Hub iframe
            hubIframe.onload = function() {
                console.log('Hub iframeåŠ è½½å®Œæˆ');
                updateStatus('status-hub', 'âœ… JupyterHub HubåŠ è½½æˆåŠŸ', 'success');
                checkIframeContent('hub-iframe', 'status-hub');
            };
            
            hubIframe.onerror = function() {
                console.log('Hub iframeåŠ è½½å¤±è´¥');
                updateStatus('status-hub', 'âŒ JupyterHub HubåŠ è½½å¤±è´¥', 'error');
            };
            
            // è¶…æ—¶æ£€æµ‹
            setTimeout(() => {
                const directStatus = document.getElementById('status-direct');
                const hubStatus = document.getElementById('status-hub');
                
                if (directStatus.classList.contains('loading')) {
                    updateStatus('status-direct', 'âš ï¸ JupyterHubåŠ è½½è¶…æ—¶', 'error');
                }
                
                if (hubStatus.classList.contains('loading')) {
                    updateStatus('status-hub', 'âš ï¸ JupyterHub HubåŠ è½½è¶…æ—¶', 'error');
                }
            }, 15000);
        }
        
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        function checkIframeContent(iframeId, statusId) {
            try {
                const iframe = document.getElementById(iframeId);
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                if (iframeDoc) {
                    const bodyText = iframeDoc.body ? iframeDoc.body.innerText : '';
                    console.log(`iframe ${iframeId} å†…å®¹é•¿åº¦: ${bodyText.length}`);
                    
                    if (bodyText.length > 50) {
                        updateStatus(statusId, 
                            `âœ… å†…å®¹æ­£å¸¸ (${bodyText.length} å­—ç¬¦)`, 
                            'success'
                        );
                    } else if (bodyText.length > 0) {
                        updateStatus(statusId, 
                            `âš ï¸ å†…å®¹è¾ƒå°‘ (${bodyText.length} å­—ç¬¦)`, 
                            'error'
                        );
                    } else {
                        updateStatus(statusId, 'âŒ å†…å®¹ä¸ºç©º (ç™½å±)', 'error');
                    }
                } else {
                    console.log(`æ— æ³•è®¿é—®iframe ${iframeId} å†…å®¹ - å¯èƒ½è·¨åŸŸé™åˆ¶`);
                    updateStatus(statusId, 'ğŸ”’ è·¨åŸŸé™åˆ¶æ— æ³•æ£€æµ‹å†…å®¹', 'loading');
                }
            } catch (e) {
                console.log(`æ£€æŸ¥iframe ${iframeId} å†…å®¹å¤±è´¥:`, e);
                updateStatus(statusId, 'ğŸ”’ æ— æ³•æ£€æµ‹å†…å®¹ (è·¨åŸŸ)', 'loading');
            }
        }
        
        function loadInIframe() {
            const directIframe = document.getElementById('direct-iframe');
            updateStatus('status-direct', 'ğŸ”„ é‡æ–°åŠ è½½ä¸­...', 'loading');
            directIframe.src = directIframe.src;
        }
        
        // ç½‘ç»œçŠ¶æ€æ£€æµ‹
        function checkNetworkStatus() {
            const urls = [
                'http://localhost:8080/',
                'http://localhost:8080/jupyterhub',
                'http://localhost:8080/jupyter/hub/login'
            ];
            
            let successCount = 0;
            let totalCount = urls.length;
            
            urls.forEach(url => {
                fetch(url, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        successCount++;
                        updateNetworkStatus(successCount, totalCount);
                    })
                    .catch(() => {
                        updateNetworkStatus(successCount, totalCount);
                    });
            });
        }
        
        function updateNetworkStatus(success, total) {
            const status = document.getElementById('network-status');
            if (success === total) {
                status.textContent = 'âœ… æ‰€æœ‰æœåŠ¡æ­£å¸¸';
                status.style.color = '#22543d';
            } else if (success > 0) {
                status.textContent = `âš ï¸ éƒ¨åˆ†æœåŠ¡å¯ç”¨ (${success}/${total})`;
                status.style.color = '#d69e2e';
            } else {
                status.textContent = 'âŒ æœåŠ¡ä¸å¯ç”¨';
                status.style.color = '#c53030';
            }
        }
        
        // å®æ—¶çŠ¶æ€æ›´æ–°
        function updateRealtimeStatus() {
            const loadStatus = document.getElementById('load-status');
            const contentStatus = document.getElementById('content-status');
            
            setInterval(() => {
                const directIframe = document.getElementById('direct-iframe');
                const hubIframe = document.getElementById('hub-iframe');
                
                let loadedCount = 0;
                if (directIframe.contentDocument || directIframe.contentWindow.document) loadedCount++;
                if (hubIframe.contentDocument || hubIframe.contentWindow.document) loadedCount++;
                
                loadStatus.textContent = `${loadedCount}/2 ä¸ªiframeå·²åŠ è½½`;
                loadStatus.style.color = loadedCount === 2 ? '#22543d' : '#d69e2e';
                
                // ç®€å•çš„å†…å®¹æ£€æµ‹
                try {
                    let hasContent = false;
                    if (directIframe.contentWindow && directIframe.contentWindow.document) {
                        const body = directIframe.contentWindow.document.body;
                        if (body && body.innerText.length > 50) hasContent = true;
                    }
                    
                    contentStatus.textContent = hasContent ? 'âœ… æ£€æµ‹åˆ°å†…å®¹' : 'âš ï¸ å†…å®¹æ£€æµ‹ä¸­';
                    contentStatus.style.color = hasContent ? '#22543d' : '#d69e2e';
                } catch (e) {
                    contentStatus.textContent = 'ğŸ”’ è·¨åŸŸé™åˆ¶';
                    contentStatus.style.color = '#a0aec0';
                }
            }, 2000);
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            setupIframeMonitoring();
            checkNetworkStatus();
            updateRealtimeStatus();
            
            console.log('JupyterHub iframeä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('å¼€å§‹ç›‘æ§iframeåŠ è½½çŠ¶æ€...');
        };
    </script>
</body>
</html>
