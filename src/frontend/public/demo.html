<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Playbook Generator - Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #1890ff;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
        }
        .section h3 {
            margin-top: 0;
            color: #262626;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .btn {
            background-color: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn:hover {
            background-color: #40a9ff;
        }
        .btn-success {
            background-color: #52c41a;
        }
        .btn-success:hover {
            background-color: #73d13d;
        }
        .result {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #a8071a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Ansible Playbook Generator</h1>
            <p>é€šè¿‡Webç•Œé¢è½»æ¾é…ç½®å¹¶ç”ŸæˆAnsible Playbook</p>
        </div>

        <!-- é¡¹ç›®é…ç½® -->
        <div class="section">
            <h3>ğŸ“‹ é¡¹ç›®é…ç½®</h3>
            <div class="form-group">
                <label>é¡¹ç›®åç§°:</label>
                <input type="text" id="projectName" value="æˆ‘çš„Webé¡¹ç›®" placeholder="è¾“å…¥é¡¹ç›®åç§°">
            </div>
            <div class="form-group">
                <label>é¡¹ç›®æè¿°:</label>
                <textarea id="projectDesc" rows="3" placeholder="è¾“å…¥é¡¹ç›®æè¿°">éƒ¨ç½²Nginx WebæœåŠ¡å™¨</textarea>
            </div>
            <button class="btn" onclick="createProject()">åˆ›å»ºé¡¹ç›®</button>
            <div id="projectResult"></div>
        </div>

        <!-- ä¸»æœºé…ç½® -->
        <div class="section">
            <h3>ğŸ–¥ï¸ ä¸»æœºé…ç½®</h3>
            <div class="form-group">
                <label>ä¸»æœºåç§°:</label>
                <input type="text" id="hostName" value="web-server-01" placeholder="ä¸»æœºåç§°">
            </div>
            <div class="form-group">
                <label>IPåœ°å€:</label>
                <input type="text" id="hostIP" value="192.168.1.100" placeholder="IPåœ°å€">
            </div>
            <div class="form-group">
                <label>SSHç«¯å£:</label>
                <input type="number" id="hostPort" value="22" placeholder="SSHç«¯å£">
            </div>
            <div class="form-group">
                <label>ç”¨æˆ·å:</label>
                <input type="text" id="hostUser" value="root" placeholder="SSHç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>ä¸»æœºç»„:</label>
                <input type="text" id="hostGroup" value="webservers" placeholder="ä¸»æœºç»„å">
            </div>
            <button class="btn" onclick="addHost()">æ·»åŠ ä¸»æœº</button>
            <div id="hostResult"></div>
        </div>

        <!-- å˜é‡é…ç½® -->
        <div class="section">
            <h3>ğŸ”§ å˜é‡é…ç½®</h3>
            <div class="form-group">
                <label>å˜é‡å:</label>
                <input type="text" id="varName" value="nginx_port" placeholder="å˜é‡å">
            </div>
            <div class="form-group">
                <label>å˜é‡å€¼:</label>
                <input type="text" id="varValue" value="80" placeholder="å˜é‡å€¼">
            </div>
            <div class="form-group">
                <label>å˜é‡ç±»å‹:</label>
                <select id="varType">
                    <option value="string">å­—ç¬¦ä¸²</option>
                    <option value="number">æ•°å­—</option>
                    <option value="boolean">å¸ƒå°”å€¼</option>
                </select>
            </div>
            <button class="btn" onclick="addVariable()">æ·»åŠ å˜é‡</button>
            <div id="variableResult"></div>
        </div>

        <!-- ä»»åŠ¡é…ç½® -->
        <div class="section">
            <h3>âš™ï¸ ä»»åŠ¡é…ç½®</h3>
            <div class="form-group">
                <label>ä»»åŠ¡åç§°:</label>
                <input type="text" id="taskName" value="å®‰è£…Nginx" placeholder="ä»»åŠ¡åç§°">
            </div>
            <div class="form-group">
                <label>Ansibleæ¨¡å—:</label>
                <input type="text" id="taskModule" value="yum" placeholder="å¦‚: yum, apt, copy, serviceç­‰">
            </div>
            <div class="form-group">
                <label>æ¨¡å—å‚æ•°:</label>
                <textarea id="taskArgs" rows="2" placeholder="æ¨¡å—å‚æ•°">name=nginx state=present</textarea>
            </div>
            <button class="btn" onclick="addTask()">æ·»åŠ ä»»åŠ¡</button>
            <div id="taskResult"></div>
        </div>

        <!-- Playbookç”Ÿæˆ -->
        <div class="section">
            <h3>ğŸ“¦ ç”ŸæˆPlaybook</h3>
            <button class="btn btn-success" onclick="generatePlaybook()">ğŸ¯ ç”ŸæˆPlaybook</button>
            <button class="btn" onclick="downloadPlaybook()" id="downloadBtn" style="display:none;">ğŸ“¥ ä¸‹è½½Playbook</button>
            <div id="playbookResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8082/api';
        let currentProjectId = null;
        let currentGenerationId = null;

        async function apiCall(method, endpoint, data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'è¯·æ±‚å¤±è´¥');
                }
                
                return result;
            } catch (error) {
                throw new Error(`APIè°ƒç”¨å¤±è´¥: ${error.message}`);
            }
        }

        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${isError ? 'error' : ''}">${message}</div>`;
        }

        async function createProject() {
            try {
                const project = await apiCall('POST', '/projects', {
                    name: document.getElementById('projectName').value,
                    description: document.getElementById('projectDesc').value
                });
                
                currentProjectId = project.id;
                showResult('projectResult', `âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸ! ID: ${project.id}\né¡¹ç›®åç§°: ${project.name}`);
            } catch (error) {
                showResult('projectResult', `âŒ é¡¹ç›®åˆ›å»ºå¤±è´¥: ${error.message}`, true);
            }
        }

        async function addHost() {
            if (!currentProjectId) {
                showResult('hostResult', 'âŒ è¯·å…ˆåˆ›å»ºé¡¹ç›®!', true);
                return;
            }

            try {
                const host = await apiCall('POST', '/hosts', {
                    project_id: currentProjectId,
                    name: document.getElementById('hostName').value,
                    ip: document.getElementById('hostIP').value,
                    port: parseInt(document.getElementById('hostPort').value),
                    user: document.getElementById('hostUser').value,
                    group: document.getElementById('hostGroup').value
                });
                
                showResult('hostResult', `âœ… ä¸»æœºæ·»åŠ æˆåŠŸ! ID: ${host.id}\nä¸»æœº: ${host.name} (${host.ip}:${host.port})`);
            } catch (error) {
                showResult('hostResult', `âŒ ä¸»æœºæ·»åŠ å¤±è´¥: ${error.message}`, true);
            }
        }

        async function addVariable() {
            if (!currentProjectId) {
                showResult('variableResult', 'âŒ è¯·å…ˆåˆ›å»ºé¡¹ç›®!', true);
                return;
            }

            try {
                const variable = await apiCall('POST', '/variables', {
                    project_id: currentProjectId,
                    name: document.getElementById('varName').value,
                    value: document.getElementById('varValue').value,
                    type: document.getElementById('varType').value
                });
                
                showResult('variableResult', `âœ… å˜é‡æ·»åŠ æˆåŠŸ! ID: ${variable.id}\nå˜é‡: ${variable.name} = ${variable.value}`);
            } catch (error) {
                showResult('variableResult', `âŒ å˜é‡æ·»åŠ å¤±è´¥: ${error.message}`, true);
            }
        }

        async function addTask() {
            if (!currentProjectId) {
                showResult('taskResult', 'âŒ è¯·å…ˆåˆ›å»ºé¡¹ç›®!', true);
                return;
            }

            try {
                const task = await apiCall('POST', '/tasks', {
                    project_id: currentProjectId,
                    name: document.getElementById('taskName').value,
                    module: document.getElementById('taskModule').value,
                    args: document.getElementById('taskArgs').value,
                    order_num: 1,
                    enabled: true
                });
                
                showResult('taskResult', `âœ… ä»»åŠ¡æ·»åŠ æˆåŠŸ! ID: ${task.id}\nä»»åŠ¡: ${task.name} (${task.module})`);
            } catch (error) {
                showResult('taskResult', `âŒ ä»»åŠ¡æ·»åŠ å¤±è´¥: ${error.message}`, true);
            }
        }

        async function generatePlaybook() {
            if (!currentProjectId) {
                showResult('playbookResult', 'âŒ è¯·å…ˆåˆ›å»ºé¡¹ç›®!', true);
                return;
            }

            try {
                const generation = await apiCall('POST', '/playbook/generate', {
                    project_id: currentProjectId
                });
                
                currentGenerationId = generation.id;
                document.getElementById('downloadBtn').style.display = 'inline-block';
                
                showResult('playbookResult', `âœ… Playbookç”ŸæˆæˆåŠŸ! 
æ–‡ä»¶å: ${generation.file_name}
çŠ¶æ€: ${generation.status}
ç”Ÿæˆæ—¶é—´: ${new Date(generation.created_at).toLocaleString()}

ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶:
- Playbook: ${generation.file_name}
- Inventory: inventory-${generation.file_name.replace('playbook-', '').replace('.yml', '.ini')}`);
            } catch (error) {
                showResult('playbookResult', `âŒ Playbookç”Ÿæˆå¤±è´¥: ${error.message}`, true);
            }
        }

        function downloadPlaybook() {
            if (!currentGenerationId) {
                showResult('playbookResult', 'âŒ è¯·å…ˆç”ŸæˆPlaybook!', true);
                return;
            }

            window.open(`${API_BASE}/playbook/download/${currentGenerationId}`, '_blank');
        }
    </script>
</body>
</html>
